<!DOCTYPE html>
<html>
<head>
    <title>Lizard Click - Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ðŸ¦Ž Lizard Click - Debug Page</h1>
    <button onclick="testAllServices()">Test All Services</button>
    <div id="results"></div>

    <script>
        const COUNT_API_BASE = 'https://silent-frost-93d1.2296744453m.workers.dev';
        const COUNT_NAMESPACE = 'lizardclick_online';
        const COUNT_KEY = 'all_clicks';
        const PANTRY_ID = 'lizardclick_online';
        const PANTRY_BASKET = 'global_clicks';

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }

        async function fetchWithTimeout(url, options = {}, timeoutMs = 5000) {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), timeoutMs);
            try {
                const res = await fetch(url, { ...options, signal: controller.signal, mode: 'cors', cache: 'no-store' });
                return res;
            } finally {
                clearTimeout(timeout);
            }
        }

        async function testCountAPI() {
            log('Testing CountAPI (Cloudflare Workers)...', 'info');
            
            try {
                // Test GET
                const getUrl = `${COUNT_API_BASE}/get/${COUNT_NAMESPACE}/${COUNT_KEY}`;
                log(`GET: ${getUrl}`, 'info');
                const res = await fetchWithTimeout(getUrl);
                log(`GET Response: ${res.status} ${res.statusText}`, res.ok ? 'success' : 'error');
                
                if (res.ok) {
                    const data = await res.json();
                    log(`GET Data: ${JSON.stringify(data)}`, 'success');
                }

                // Test CREATE
                const createUrl = `${COUNT_API_BASE}/create?namespace=${encodeURIComponent(COUNT_NAMESPACE)}&key=${encodeURIComponent(COUNT_KEY)}&value=0`;
                log(`CREATE: ${createUrl}`, 'info');
                const resCreate = await fetchWithTimeout(createUrl);
                log(`CREATE Response: ${resCreate.status} ${resCreate.statusText}`, resCreate.ok ? 'success' : 'error');
                
                if (resCreate.ok) {
                    const data = await resCreate.json();
                    log(`CREATE Data: ${JSON.stringify(data)}`, 'success');
                }
            } catch (error) {
                log(`CountAPI Error: ${error.message}`, 'error');
            }
        }

        async function testPantry() {
            log('\nTesting Pantry...', 'info');
            
            try {
                // Test GET
                const getUrl = `https://getpantry.cloud/apiv1/pantry/${PANTRY_ID}/basket/${PANTRY_BASKET}`;
                log(`GET: ${getUrl}`, 'info');
                const res = await fetchWithTimeout(getUrl);
                log(`GET Response: ${res.status} ${res.statusText}`, res.ok ? 'success' : 'error');
                
                if (res.ok) {
                    const data = await res.json();
                    log(`GET Data: ${JSON.stringify(data)}`, 'success');
                } else if (res.status === 404) {
                    // Test CREATE
                    log('Basket not found, creating...', 'info');
                    const createUrl = getUrl;
                    log(`POST: ${createUrl}`, 'info');
                    const createRes = await fetchWithTimeout(createUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ count: 0 })
                    });
                    log(`POST Response: ${createRes.status} ${createRes.statusText}`, createRes.ok ? 'success' : 'error');
                }
            } catch (error) {
                log(`Pantry Error: ${error.message}`, 'error');
            }
        }

        async function testAllServices() {
            document.getElementById('results').innerHTML = '';
            log('Starting service tests...', 'info');
            
            await testCountAPI();
            await testPantry();
            
            log('\nTests completed!', 'info');
        }
    </script>
</body>
</html>